充值对账流程(2018-01-01 00:00之后)

2018年充值成功的所有记录

SELECT COUNT(*) FROM adm_lease_recharge_record WHERE   `pay_success_time` >= DATE('2018-01-01') ;

SELECT `record_id` , `user_id` , `flow_id` ,`amount` , `pay_status` , `pay_type` ,`pay_success_time` FROM adm_lease_recharge_record WHERE   `pay_success_time` >= DATE('2018-01-01');



 1 财务充值
	a 找出所有财务充值 同样流水号 对同一个用户充值的情况

SELECT `user_id` , `flow_id` ,`amount` , `pay_status` , `pay_type` ,`pay_success_time` , message FROM `adm_lease_recharge_record` WHERE CONCAT(flow_id,user_id) IN 
(

SELECT a.fu FROM (
    SELECT  COUNT(CONCAT(flow_id,user_id))  ct, CONCAT(flow_id,user_id) fu  FROM adm_lease_recharge_record 
    WHERE `pay_status` =1 AND `pay_success_time` >= DATE('2018-01-01')
    AND `flow_id` <> ''
    GROUP BY  CONCAT(flow_id,user_id) 
    HAVING ct>1

)a
) ORDER BY pay_success_time
	
	b 查询财务充值 没有填序列号的情况

SELECT `record_id` , `user_id` , `flow_id` ,`amount` , `pay_status` , `pay_type` ,`pay_success_time` , message
FROM `adm_lease_recharge_record` 
WHERE   `pay_success_time` >= DATE('2018-01-01')
AND `pay_type` = 3
AND (`flow_id` IS NULL  OR `flow_id`='')
	
	c 查询本地存在但是在财务流水中不存在
SELECT
*
FROM `adm_lease_recharge_record` 
WHERE   `pay_success_time` >= DATE('2018-01-01')
AND `pay_success_time` < DATE('2018-01-26')
AND `pay_type` = 3
AND `pay_status` = 1
AND flow_id IS NOT NULL
AND `flow_id`  not IN 
(
'C0076200021862C',
'20180102200040011100780087961639',
'20171231200040011100560084393990',
'20180102200040011100930089846593',
'G3034400133097C',
'20171230200040011100890087829830',
'G3034600139429C',
'G2616300336952C',
'K3291800045816C',
'G8888500186315C',
'20180103200040011100700091215688',
'G3752600177705C',
'20180102200040011100520087015397',
'G9758100009721C',
'G3034400112843C',
'20180104200040011100970091231077',
'20171231200040011100330083290508',
'G5307800003081C',
'G8409400043094C',
'G8409500045331C',
'20180104200040011100440088361510',
'G5088700062353C',
'G8409500105963C',
'20180105200040011100470089280631',
'G4578900153425C',
'G4578900140107C',
'K9973900168963C',
'K4623900023243C',
'K7821400093918C',
'C0950600032905C',
'20180103200040011100780088619745',
'20180106200040011100200090591700',
'G4578900173357C',
'20180105200040011100470089106283',
'G3832200190080C',
'20180108200040011100360091968278',
'G0353200021815C',
'G4578900173393C',
'20180106200040011100610092356543',
'20180109200040011100470092301409',
'20180109200040011100470092301409',
'20180109200040011100470092369364',
'G2857200042480C',
'K8089100059047C',
'20180108200040011100220091160176',
'G8012300040383C',
'20180110200040011100320095550241',
'20180110200040011100500091440361',
'G3715700135526C',
'20180110200040011100120094884108',
'20180110200040011100400092256582',
'G3715600101777C',
'20180110200040011100500091251390',
'20180110200040011100460093966019',
'20180110200040011100600094613368',
'20180110200040011100120094423607',
'20180109200040011100970095302910',
'20180109200040011100600094063107',
'G2857200075884C',
'20180111200040011100410091776500',
'20180111200040011100480094078336',
'20180111200040011100120095404699',
'K3256000054819C',
'K3255500097910C',
'20180110200040011100460093933113',
'20180110200040011100790094270000',
'20180110200040011100470093414643',
'K4964801028630C',
'20180112200040011100890098213241',
'G3715600143211C',
'20180112200040011100360095087159',
'G5438800037540C',
'20180112200040011100100096093339',
'20180112200040011100960095409609',
'20180112200040011100260095812534',
'G9789800013267C',
'20180112200040011100630097800467',
'G5438600047931C',
'G9789800021507C',
'G0064700138056C',
'20180112200040011100780095735855',
'20180112200040011100700098086979',
'20180111200040011100740095474217',
'20180111200040011100870096171931',
'K9544400045617C',
'20180115200040011100830098991010',
'G3020800083955C',
'20180115200040011100370094292079',
'G9658300169562C',
'G5652100005862C',
'G9658500164783C',
'20180115200040011100030096140154',
'G5438700040210C',
'G9658300180888C',
'20180113200040011100160096588773',
'20180115200040011100210095553274',
'20180112200040011100120096315616',
'20180112200040011100120096490104',
'20180114200040011100240095642060',
'G5438800130026C',
'20180115200040011100780097761238',
'G5438700086130C',
'G5438800084140C',
'G3752600230114C',
'G9788400585131C',
'G9719500106356C',
'C0300100013639C',
'K4965000926851C',
'G9658400206750C',
'G9658400206750C',
'20180116200040011100890001058754',
'20180116200040011100640098923864',
'C0187200011964C',
'G0853500007823C',
'20180116200040011100430094413967',
'20180115200040011100030095994058',
'20180116200040011100050098184880',
'20180115200040011100140098441149',
'20180115200040011100140098441149',
'20180115200040011100140098441149',
'20180115200040011100140098441149',
'20180115200040011100140098441149',
'20180115200040011100140098441149',
'20180115200040011100140098441149',
'20180115200040011100230095226310',
'20180115200040011100610099504477',
'20180117200040011100140000195935',
'20180117200040011100130097739506',
'20180117200040011100230097006157',
'K0133800034515C',
'20180117200040011100230097053472',
'20180116200040011100850099523018',
'G0632100222696C',
'G7837300202475C',
'G4855000074657C',
'20180117200040011100120000015687',
'20180117200040011100690001341021',
'G4536300538739C',
'G5449600006747C',
'20180117200040011100360098884257',
'20180115200040011100450096245622',
'K0133000053461C',
'G9719500036393C',
'G9719500120489C',
'20180117200040011100870000528777',
'20180116200040011100490097027257',
'20180116200040011100490097027257',
'G2857200015360C',
'K3764700070296C',
'G0632000052714C',
'G5449600042321C',
'G8629600119420C',
'G2854000106479C',
'G3715700105424C',
'K9544000036321C',
'G4536200031543C',
'K0133400074913C',
'K0694000196215C',
'K0133700043463C',
'K9167900049509C',
'20180117200040011100230097222822',
'20180117200040011100160099643257',
'20180118200040011100260000320870',
'G6651900051856C',
'20180118200040011100750004656705',
'G9719500031397C',
'20180119200040011100400099085606',
'20180119200040011100680002683308',
'20180118200040011100320001091901',
'20180119200040011100660001719734',
'K2171100230770C',
'20180119200040011100250099240132',
'20180118200040011100720001225836',
'20180118200040011100380000399051',
'20180118200040011100640000870736',
'G1416000070396C',
'20180115200040011100140098441149',
'G5438800041186C',
'G6651700135676C',
'G1416000071930C',
'G6651700197734C',
'K2171500247103C',
'C0451300010317C',
'G8448200005201C',
'G8448300176690C',
'20180118200040011100790099714223',
'G9719500031397C',
'K8026800032268C',
'20180122200040011100470001826080',
'20180122200040011100600003314464',
'20180122200040011100230000241080',
'20180120200040011100120002088321',
'20180120200040011100780002054162',
'20180120200040011100800002309756',
'C0613300018417C',
'G8540300067013C',
'20180115200040011100450096118804',
'20180114200040011100530095547434',
'G8540300162587C',
'20180123200040011100870004809329',
'20180123200040011100780003835012',
'G8541400197478C',
'G9330900228059C',
'20180124200040011100460004226935',
'20180124200040011100560002308009',
'20180124200040011100560002322431',
'20180116200040011100880001544004',
'20180124200040011100020004064422',
'20180124200040011100110001980691',
'G8744400045104C',
'K9167700024269C',
'K3204100289045C',
'20180104200040011100890091707951',
'20180123200040011100090002404440',
'20180108110070001502270045975199',
'K3204300313570C',
'20180125200040011100870006150743',
'20180125200040011100870006177782',
'G8541400253378C',
'C0791800010424C',
'20180125200040011100900004724928',
'20180124200040011100740004743264',
'K4101700044693C',
'20180122200040011100680004648984',
'20180125200040011100730005735353',
'G9330900158963C',
'20180124200040011100020004269046',
'K2171500247103C',
'20180124200040011100330002049707',
'G9330700187790C'
) 
AND `record_id` NOT IN 
(

'08151488202426100034',
'08151523202096500000',
'08151522872648700004',
'08151522872631600000',
'08151556756060800050',
'08151566774013300002',
'08151566745918200001',
'08151563898774300089',
'08151563754541700085',
'08151574418737400012',
'08151573773168400041',
'08151608156144500039',
'08151607411378300024',
'08151660410387700055',
'08151677549626800016',
'08151686691014300006',
'08151684658575200041'
)

	d获取财务中流水在数据库中不存在

	
select fwId from
(
select 'C0076200021862C' as fwId union all
select '20180102200040011100780087961639' as fwId union all
select '20171231200040011100560084393990' as fwId union all
select '20180102200040011100930089846593' as fwId union all
select 'G3034400133097C' as fwId union all
select '20171230200040011100890087829830' as fwId union all
select 'G3034600139429C' as fwId union all
select 'G2616300336952C' as fwId union all
select 'K3291800045816C' as fwId union all
select 'G8888500186315C' as fwId union all
select '20180103200040011100700091215688' as fwId union all
select 'G3752600177705C' as fwId union all
select '20180102200040011100520087015397' as fwId union all
select 'G9758100009721C' as fwId union all
select 'G3034400112843C' as fwId union all
select '20180104200040011100970091231077' as fwId union all
select '20171231200040011100330083290508' as fwId union all
select 'G5307800003081C' as fwId union all
select 'G8409400043094C' as fwId union all
select 'G8409500045331C' as fwId union all
select '20180104200040011100440088361510' as fwId union all
select 'G5088700062353C' as fwId union all
select 'G8409500105963C' as fwId union all
select '20180105200040011100470089280631' as fwId union all
select 'G4578900153425C' as fwId union all
select 'G4578900140107C' as fwId union all
select 'K9973900168963C' as fwId union all
select 'K4623900023243C' as fwId union all
select 'K7821400093918C' as fwId union all
select 'C0950600032905C' as fwId union all
select '20180103200040011100780088619745' as fwId union all
select '20180106200040011100200090591700' as fwId union all
select 'G4578900173357C' as fwId union all
select '20180105200040011100470089106283' as fwId union all
select 'G3832200190080C' as fwId union all
select '20180108200040011100360091968278' as fwId union all
select 'G0353200021815C' as fwId union all
select 'G4578900173393C' as fwId union all
select '20180106200040011100610092356543' as fwId union all
select '20180109200040011100470092301409' as fwId union all
select '20180109200040011100470092301409' as fwId union all
select '20180109200040011100470092369364' as fwId union all
select 'G2857200042480C' as fwId union all
select 'K8089100059047C' as fwId union all
select '20180108200040011100220091160176' as fwId union all
select 'G8012300040383C' as fwId union all
select '20180110200040011100320095550241' as fwId union all
select '20180110200040011100500091440361' as fwId union all
select 'G3715700135526C' as fwId union all
select '20180110200040011100120094884108' as fwId union all
select '20180110200040011100400092256582' as fwId union all
select 'G3715600101777C' as fwId union all
select '20180110200040011100500091251390' as fwId union all
select '20180110200040011100460093966019' as fwId union all
select '20180110200040011100600094613368' as fwId union all
select '20180110200040011100120094423607' as fwId union all
select '20180109200040011100970095302910' as fwId union all
select '20180109200040011100600094063107' as fwId union all
select 'G2857200075884C' as fwId union all
select '20180111200040011100410091776500' as fwId union all
select '20180111200040011100480094078336' as fwId union all
select '20180111200040011100120095404699' as fwId union all
select 'K3256000054819C' as fwId union all
select 'K3255500097910C' as fwId union all
select '20180110200040011100460093933113' as fwId union all
select '20180110200040011100790094270000' as fwId union all
select '20180110200040011100470093414643' as fwId union all
select 'K4964801028630C' as fwId union all
select '20180112200040011100890098213241' as fwId union all
select 'G3715600143211C' as fwId union all
select '20180112200040011100360095087159' as fwId union all
select 'G5438800037540C' as fwId union all
select '20180112200040011100100096093339' as fwId union all
select '20180112200040011100960095409609' as fwId union all
select '20180112200040011100260095812534' as fwId union all
select 'G9789800013267C' as fwId union all
select '20180112200040011100630097800467' as fwId union all
select 'G5438600047931C' as fwId union all
select 'G9789800021507C' as fwId union all
select 'G0064700138056C' as fwId union all
select '20180112200040011100780095735855' as fwId union all
select '20180112200040011100700098086979' as fwId union all
select '20180111200040011100740095474217' as fwId union all
select '20180111200040011100870096171931' as fwId union all
select 'K9544400045617C' as fwId union all
select '20180115200040011100830098991010' as fwId union all
select 'G3020800083955C' as fwId union all
select '20180115200040011100370094292079' as fwId union all
select 'G9658300169562C' as fwId union all
select 'G5652100005862C' as fwId union all
select 'G9658500164783C' as fwId union all
select '20180115200040011100030096140154' as fwId union all
select 'G5438700040210C' as fwId union all
select 'G9658300180888C' as fwId union all
select '20180113200040011100160096588773' as fwId union all
select '20180115200040011100210095553274' as fwId union all
select '20180112200040011100120096315616' as fwId union all
select '20180112200040011100120096490104' as fwId union all
select '20180114200040011100240095642060' as fwId union all
select 'G5438800130026C' as fwId union all
select '20180115200040011100780097761238' as fwId union all
select 'G5438700086130C' as fwId union all
select 'G5438800084140C' as fwId union all
select 'G3752600230114C' as fwId union all
select 'G9788400585131C' as fwId union all
select 'G9719500106356C' as fwId union all
select 'C0300100013639C' as fwId union all
select 'K4965000926851C' as fwId union all
select 'G9658400206750C' as fwId union all
select 'G9658400206750C' as fwId union all
select '20180116200040011100890001058754' as fwId union all
select '20180116200040011100640098923864' as fwId union all
select 'C0187200011964C' as fwId union all
select 'G0853500007823C' as fwId union all
select '20180116200040011100430094413967' as fwId union all
select '20180115200040011100030095994058' as fwId union all
select '20180116200040011100050098184880' as fwId union all
select '20180115200040011100140098441149' as fwId union all
select '20180115200040011100140098441149' as fwId union all
select '20180115200040011100140098441149' as fwId union all
select '20180115200040011100140098441149' as fwId union all
select '20180115200040011100140098441149' as fwId union all
select '20180115200040011100140098441149' as fwId union all
select '20180115200040011100140098441149' as fwId union all
select '20180115200040011100230095226310' as fwId union all
select '20180115200040011100610099504477' as fwId union all
select '20180117200040011100140000195935' as fwId union all
select '20180117200040011100130097739506' as fwId union all
select '20180117200040011100230097006157' as fwId union all
select 'K0133800034515C' as fwId union all
select '20180117200040011100230097053472' as fwId union all
select '20180116200040011100850099523018' as fwId union all
select 'G0632100222696C' as fwId union all
select 'G7837300202475C' as fwId union all
select 'G4855000074657C' as fwId union all
select '20180117200040011100120000015687' as fwId union all
select '20180117200040011100690001341021' as fwId union all
select 'G4536300538739C' as fwId union all
select 'G5449600006747C' as fwId union all
select '20180117200040011100360098884257' as fwId union all
select '20180115200040011100450096245622' as fwId union all
select 'K0133000053461C' as fwId union all
select 'G9719500036393C' as fwId union all
select 'G9719500120489C' as fwId union all
select '20180117200040011100870000528777' as fwId union all
select '20180116200040011100490097027257' as fwId union all
select '20180116200040011100490097027257' as fwId union all
select 'G2857200015360C' as fwId union all
select 'K3764700070296C' as fwId union all
select 'G0632000052714C' as fwId union all
select 'G5449600042321C' as fwId union all
select 'G8629600119420C' as fwId union all
select 'G2854000106479C' as fwId union all
select 'G3715700105424C' as fwId union all
select 'K9544000036321C' as fwId union all
select 'G4536200031543C' as fwId union all
select 'K0133400074913C' as fwId union all
select 'K0694000196215C' as fwId union all
select 'K0133700043463C' as fwId union all
select 'K9167900049509C' as fwId union all
select '20180117200040011100230097222822' as fwId union all
select '20180117200040011100160099643257' as fwId union all
select '20180118200040011100260000320870' as fwId union all
select 'G6651900051856C' as fwId union all
select '20180118200040011100750004656705' as fwId union all
select 'G9719500031397C' as fwId union all
select '20180119200040011100400099085606' as fwId union all
select '20180119200040011100680002683308' as fwId union all
select '20180118200040011100320001091901' as fwId union all
select '20180119200040011100660001719734' as fwId union all
select 'K2171100230770C' as fwId union all
select '20180119200040011100250099240132' as fwId union all
select '20180118200040011100720001225836' as fwId union all
select '20180118200040011100380000399051' as fwId union all
select '20180118200040011100640000870736' as fwId union all
select 'G1416000070396C' as fwId union all
select '20180115200040011100140098441149' as fwId union all
select 'G5438800041186C' as fwId union all
select 'G6651700135676C' as fwId union all
select 'G1416000071930C' as fwId union all
select 'G6651700197734C' as fwId union all
select 'K2171500247103C' as fwId union all
select 'C0451300010317C' as fwId union all
select 'G8448200005201C' as fwId union all
select 'G8448300176690C' as fwId union all
select '20180118200040011100790099714223' as fwId union all
select 'G9719500031397C' as fwId union all
select 'K8026800032268C' as fwId union all
select '20180122200040011100470001826080' as fwId union all
select '20180122200040011100600003314464' as fwId union all
select '20180122200040011100230000241080' as fwId union all
select '20180120200040011100120002088321' as fwId union all
select '20180120200040011100780002054162' as fwId union all
select '20180120200040011100800002309756' as fwId union all
select 'C0613300018417C' as fwId union all
select 'G8540300067013C' as fwId union all
select '20180115200040011100450096118804' as fwId union all
select '20180114200040011100530095547434' as fwId union all
select 'G8540300162587C' as fwId union all
select '20180123200040011100870004809329' as fwId union all
select '20180123200040011100780003835012' as fwId union all
select 'G8541400197478C' as fwId union all
select 'G9330900228059C' as fwId union all
select '20180124200040011100460004226935' as fwId union all
select '20180124200040011100560002308009' as fwId union all
select '20180124200040011100560002322431' as fwId union all
select '20180116200040011100880001544004' as fwId union all
select '20180124200040011100020004064422' as fwId union all
select '20180124200040011100110001980691' as fwId union all
select 'G8744400045104C' as fwId union all
select 'K9167700024269C' as fwId union all
select 'K3204100289045C' as fwId union all
select '20180104200040011100890091707951' as fwId union all
select '20180123200040011100090002404440' as fwId union all
select '20180108110070001502270045975199' as fwId union all
select 'K3204300313570C' as fwId union all
select '20180125200040011100870006150743' as fwId union all
select '20180125200040011100870006177782' as fwId union all
select 'G8541400253378C' as fwId union all
select 'C0791800010424C' as fwId union all
select '20180125200040011100900004724928' as fwId union all
select '20180124200040011100740004743264' as fwId union all
select 'K4101700044693C' as fwId union all
select '20180122200040011100680004648984' as fwId union all
select '20180125200040011100730005735353' as fwId union all
select 'G9330900158963C' as fwId union all
select '20180124200040011100020004269046' as fwId union all
select 'K2171500247103C' as fwId union all
select '20180124200040011100330002049707' as fwId union all
select 'G9330700187790C' as fwId  
) a
WHERE fwId  not in 
(
SELECT
`flow_id`
FROM `adm_lease_recharge_record` 
WHERE   `pay_success_time` >= DATE('2018-01-01')
AND `pay_success_time` < DATE('2018-01-26')
AND `pay_type` = 3
AND `pay_status` = 1
AND flow_id IS NOT NULL )
    
	












